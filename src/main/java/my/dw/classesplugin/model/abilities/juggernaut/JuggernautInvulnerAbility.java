package my.dw.classesplugin.model.abilities.juggernaut;

import my.dw.classesplugin.model.abilities.ActiveAbility;
import my.dw.classesplugin.utils.Constants;
import org.bukkit.Material;
import org.bukkit.entity.Player;
import org.bukkit.inventory.ItemStack;
import org.bukkit.potion.PotionEffect;
import org.bukkit.potion.PotionEffectType;

import java.util.List;
import java.util.Objects;

import static my.dw.classesplugin.utils.AbilityUtils.generateItemMetaTrigger;
import static org.bukkit.attribute.Attribute.GENERIC_MAX_HEALTH;

public class JuggernautInvulnerAbility extends ActiveAbility {

    private final PotionEffect effect;

    public JuggernautInvulnerAbility() {
        super(
            "Immovable Object",
            generateItemMetaTrigger(
                Material.INK_SAC,
                "Immovable Object",
                List.of("Sacrifice 50% current HP; Grants invulnerability for 10s", "Cooldown: 30s")),
            10,
            30
        );
        this.effect = new PotionEffect(PotionEffectType.DAMAGE_RESISTANCE, this.duration * Constants.TICKS_PER_SECOND, 4);
    }

    @Override
    public boolean handleAbility(final Player player, ItemStack itemTrigger) {
        if (Objects.isNull(player.getAttribute(GENERIC_MAX_HEALTH))
            || player.getHealth() < (player.getAttribute(GENERIC_MAX_HEALTH).getValue() / 5)) {
            player.sendMessage("You need at least 40% Max HP to activate this ability");
            return false;
        }

        player.setHealth(player.getHealth() / 2);
        return player.addPotionEffect(effect);
    }

}
