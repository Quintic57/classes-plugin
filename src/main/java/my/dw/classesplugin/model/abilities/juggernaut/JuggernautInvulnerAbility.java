package my.dw.classesplugin.model.abilities.juggernaut;

import static org.bukkit.attribute.Attribute.GENERIC_MAX_HEALTH;

import my.dw.classesplugin.model.Class;
import my.dw.classesplugin.model.abilities.ActiveAbility;
import org.bukkit.Material;
import org.bukkit.attribute.Attribute;
import org.bukkit.entity.Player;

import java.time.Duration;
import java.time.Instant;
import java.util.HashMap;
import java.util.Objects;

public class JuggernautInvulnerAbility extends ActiveAbility {

    public JuggernautInvulnerAbility() {
        super("Immovable Object", generateItemTrigger(Material.INK_SAC, "Immovable Object"), 10, 30, new HashMap<>());
    }

    @Override
    public void handleAbility(final Player player) {
        if (!player.getMetadata("character_class").get(0).asString().equals(Class.ASSASSIN.name())) {
            return;
        }

        if (Objects.isNull(player.getAttribute(GENERIC_MAX_HEALTH))
            || player.getHealth() < (player.getAttribute(GENERIC_MAX_HEALTH).getValue() / 5)) {
            player.sendMessage("You need at least 40% Max HP to activate this ability");
            return;
        }

        player.setInvulnerable(true);
        player.setHealth(player.getHealth() / 2);
    }

}
